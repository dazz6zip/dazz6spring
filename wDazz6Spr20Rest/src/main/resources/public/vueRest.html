<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>public/vueRest.html</title>
<script src="https://unpkg.com/vue@3"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style type="text/css">
#infoTable {
	border: 1px solid tomato;
	border-collapse: collapse;
}

th, td {
	padding: 8px;
	color: tomato
}

th {
	background-color: tomato;
	color: greenyellow;
}

button {
	border: none;
	color: greenyellow;
	background-color: tomato;
	border-radius: 15px;
	padding: 5px;
	padding-left: 8px;
	padding-right: 8px;
}

input {
	padding: 8px;
	border: 1px solid;
	color: tomato;
}
</style>
</head>
<body>
	<div id="app">
		<h2>ğŸ… íšŒì› ì •ë³´</h2>
		<table id="infoTable">
			<thead>
				<tr>
					<th>ë²ˆí˜¸</th>
					<th>ì£¼ì†Œ</th>
					<th>ì´ë¦„</th>
					<th>ìˆ˜ì •/ì‚­ì œ</th>
				</tr>
			</thead>
			<tbody>
				<tr v-for="(m, index) in members" :key="index">
					<td><b>{{m.num}}</b></td>
					<td>{{m.name}}</td>
					<td>{{m.addr}}</td>
					<td>
						<button @click="updateMember(m)">ìˆ˜ì •</button>&nbsp;
						<button @click="deleteMember(m.num)">ì‚­ì œ</button>
					</td>
				</tr>
			</tbody>
		</table>

		<h2>ğŸ… íšŒì› ì¶”ê°€ ë˜ëŠ” ìˆ˜ì •</h2>
		<form @submit.prevent="saveMember">
			<table>
				<tr>
					<td><input v-model="memberForm.name" placeholder="ì´ë¦„ ì…ë ¥"
						required></td>
					<td rowspan="2">
						<button type="submit">
							{{memberForm.num ? "edit" : "add" }}
						</button>
					</td>
				</tr>
				<tr>
					<td><input v-model="memberForm.addr" placeholder="ì£¼ì†Œ ì…ë ¥"
						required></td>
				</tr>
			</table>
		</form>
	</div>

	<script type="text/javascript">
	const { createApp, ref, onMounted } = Vue;
	createApp({
		setup() {
			const members = ref([]);

			// ë°˜ì‘í˜• ë°ì´í„°ë¡œ ë™ì‘ : Vue Componentì—ì„œ ë³€ê²½ë  ë•Œ ìë™ ì¶”ì , UI ë¦¬ë Œë”ë§
			const memberForm = ref({ num: null, name: "", addr: "" });
			
			// ìë£Œ ì½ê¸° ajax ì²˜ë¦¬ í•¨ìˆ˜
			const fetchNumbers = async() => {
				const response = await axios.get("/members");
				members.value = response.data;
			};
			
			// íšŒì› ì •ë³´ ì €ì¥ (ìˆ˜ì • ë˜ëŠ” ì¶”ê°€)
			const saveMember = async() => {
				if(memberForm.value.num) {
					// memberForm.value.num ê°’ì´ ìˆì„ ê²½ìš° íšŒì› ìˆ˜ì •
					await axios.put(`/members/${memberForm.value.num}`, memberForm.value);
				} else {
					await axios.post("/members", memberForm.value);
				}
				
				// ì €ì¥ í›„ ì…ë ¥ ìë£Œ ì§€ìš°ê¸° (ë°ì´í„° í¼ ì´ˆê¸°í™”)
				memberForm.value = ref({ num: null, name: "", addr: "" });
				fetchNumbers();
			};
			
			// íšŒì› ì‚­ì œ
			const deleteMember = async(num) => {
				await axios.delete(`/members/${num}`);
				fetchNumbers();
			}
			
			// íšŒì› ì •ë³´ ìˆ˜ì •
			const updateMember = (member) => {
				memberForm.value = {...member};
			}
			
			onMounted(fetchNumbers); // Componentê°€ mount ë˜ë©´ fetchNumbers í˜¸ì¶œ

			return { members, memberForm, saveMember, deleteMember, updateMember };
			
		},
	}).mount("#app");
	</script>
</body>
</html>