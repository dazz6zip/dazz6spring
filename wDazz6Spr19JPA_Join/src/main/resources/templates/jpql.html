<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>templates/jpql.html</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style type="text/css">
#inputSql {
	border: 1;
	width: 100%;
	font-size: 80%;
} 

</style>
</head>
<body>
	<div class="container">
		<h2>ğŸ¥ JPQL ì—°ìŠµì¥</h2>
		<textarea id="inputSql" class="form-control">SELECT e FROM Emp AS e</textarea>
		<button id="exeBtn" class="btn btn-secondary btn-sm">ì‹¤í–‰</button>
		<div>
			<code id="result">JSON ê²°ê³¼</code>
		</div>
	</div>
	<script type="text/javascript">
		document.querySelector("#exeBtn").addEventListener("click", () => {
			const sql = document.querySelector("#inputSql").value;
			
			// URLSearchParams : ì£¼ì†Œì°½ì˜ ê²½ë¡œë¥¼ ë‹¤ë£° ìˆ˜ ìˆëŠ” ë¸Œë¼ìš°ì €ì˜ ë‚´ì¥ ê°ì²´
			// URLì˜ query ë¬¸ìì—´ì„ ì‰½ê²Œ êµ¬ì„± ë° ì¡°ì‘í•  ìˆ˜ ìˆëŠ” ì›¹ API
			const queryString = new URLSearchParams({query:sql}).toString();
//			alert(queryString);
			
			// ìš”ì²­ ì •ë³´ : /jpql/test
			fetch("[[@{/}]]jpql/test", { // í•´ë‹¹ ìš”ì²­ì´ ë“¤ì–´ê°€ë©´
				method: "POST",
				headers: {"Content-type" : "application/x-www-form-urlencoded;charset=utf-8"}, // GETì¼ ê²½ìš° ìƒëµ
				body: queryString // ìš”ì²­ ë³¸ë¬¸ì— query ë¬¸ í¬í•¨
			})
			.then(res => res.json()) // promise ê°ì²´ ë°˜í™˜ (JSONìœ¼ë¡œ ë³€í™˜)
			.then(data => {
				console.log(data);
				const result = JSON.stringify(data, null, 3);
				document.querySelector("#result").innerText = result;
			}); // ë°˜í™˜ê°’ consoleë¡œ ì°ì–´ ë³´ê¸°
		})
	</script>
</body>
</html>